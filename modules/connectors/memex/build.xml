<project default="all">

    <target name="clean">
        <delete dir="build"/>
        <delete dir="dist"/>
        <delete dir="doc"/>
    </target>

    <target name="calculate-condition">
        <available file="mxie-java/JavaMXIELIB.jar" property="mxieStatus"/>
        <condition property="canBuild">
            <isset property="mxieStatus"/>
        </condition>
    </target>

    <target name="precompile-check" depends="calculate-condition" unless="canBuild">
        <echo message="Memex Connector cannot be built without JavaMXIELIB.jar"/>
    </target>

    <target name="doc" depends="precompile-check" if="canBuild">
        <mkdir dir="doc"/>
        <javadoc destdir="doc" classpath="mxie-java/JavaMXIELIB.jar:lib/servlet-api.jar:lib/jdbcpool-0.99.jar:lib/postgresql.jar:lib/commons-fileupload.jar:lib/serializer.jar:lib/log4j-1.2.jar:lib/commons-logging.jar:lib/commons-httpclient-lcf.jar:lib/lcf-core.jar:lib/lcf-agents.jar:lib/lcf-pull-agent.jar:lib/xml-apis.jar:lib/xalan2.jar:lib/commons-collections.jar:lib/commons-codec.jar:lib/commons-io.jar" source="1.5">
            <classpath>
                <fileset dir="lib" includes="*.jar"/>
                <fileset dir="mxie-java" includes="*.jar"/>
            </classpath>
            <fileset dir="connector" includes="**/*.java"/>
        </javadoc>
    </target>

    <target name="compile-connector" depends="precompile-check" if="canBuild">
        <mkdir dir="build/connector/classes"/>
        <javac srcdir="connector" destdir="build/connector/classes" classpath="${classpath}" target="1.5" source="1.5" debug="true" debuglevel="lines,vars,source">
            <classpath>
                <fileset dir="lib" includes="*.jar"/>
                <fileset dir="mxie-java" includes="*.jar"/>
            </classpath>
        </javac>
    </target>

    <target name="jar-connector" depends="compile-connector,precompile-check" if="canBuild">
        <mkdir dir="build/jar"/>
        <jar destfile="build/jar/lcf-memex-connector.jar" basedir="build/connector/classes"/>
    </target>

    <target name="webapp-crawler-ui" depends="jar-connector,precompile-check" if="canBuild">
        <mkdir dir="build/webapp/crawler-ui/WEB-INF/lib"/>
        <copy todir="build/webapp/crawler-ui/WEB-INF/lib" file="build/jar/lcf-memex-connector.jar"/>
        <copy todir="build/webapp/crawler-ui/WEB-INF/lib">
            <fileset dir="mxie-java" includes="*.jar"/>
        </copy>
        <mkdir dir="build/webapp/crawler-ui"/>
        <copy todir="build/webapp/crawler-ui">
            <fileset dir="crawler-ui" includes="**/*.jsp,**/*.css,**/*.png,**/*.html"/>
        </copy>
    </target>

    <target name="webapp-authority-service" depends="jar-connector,precompile-check" if="canBuild">
        <mkdir dir="build/webapp/authority-service/WEB-INF/lib"/>
        <copy todir="build/webapp/authority-service/WEB-INF/lib" file="build/jar/lcf-memex-connector.jar"/>
        <copy todir="build/webapp/authority-service/WEB-INF/lib">
            <fileset dir="mxie-java" includes="*.jar"/>
        </copy>
    </target>

    <target name="iar-crawler-ui" depends="webapp-crawler-ui,precompile-check" if="canBuild">
        <mkdir dir="dist/web/war"/>
        <jar destfile="dist/web/war/lcf-memexconnector-crawler-ui.iar" basedir="build/webapp/crawler-ui"/>
    </target>

    <target name="iar-authority-service" depends="webapp-authority-service,precompile-check" if="canBuild">
        <mkdir dir="dist/web/war"/>
        <jar destfile="dist/web/war/lcf-memexconnector-authority-service.iar" basedir="build/webapp/authority-service"/>
    </target>

    <target name="processes" depends="jar-connector,precompile-check" if="canBuild">
        <mkdir dir="dist/processes/jar"/>
        <copy todir="dist/processes/jar" file="build/jar/lcf-memex-connector.jar"/>
        <copy todir="dist/processes/jar">
            <fileset dir="mxie-java" includes="*.jar"/>
        </copy>
    </target>

    <target name="all" depends="processes,iar-crawler-ui,iar-authority-service,doc"/>
    
</project>
